<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estrategia de Alcance: Iris Inclusión</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Warm Earth Tones -->
    <!-- Application Structure Plan: The SPA is designed with a thematic, top-down structure to guide the user from the general vision to specific details. It starts with an introduction ('Inicio'), moves to foundational concepts ('Principios Clave'), explores external benchmarks ('Modelos de Inspiración'), details the core strategic plan ('Plan Estratégico'), and concludes with future strategy and contact options ('Sostenibilidad' y 'Contacto'). This non-linear, thematic flow enhances usability by allowing users to dive into sections of interest. Interactions like a dynamic chart and accordions are used to condense complex information and make comparison and exploration intuitive. -->
    <!-- Visualization & Content Choices: Report Info: Comparative analysis of external models. -> Goal: Compare methodologies. -> Viz/Presentation Method: Horizontal Bar Chart. -> Interaction: Tooltips on hover provide details. -> Justification: A bar chart offers a quick, scannable comparison of qualitative features across multiple models, making it easier to identify common practices than a dense table. -> Library/Method: Chart.js (Canvas). Report Info: Strategic plan recommendations. -> Goal: Organize and present proposed changes. -> Viz/Presentation Method: Accordion component. -> Interaction: Clicking a module header expands to show detailed recommendations. -> Justification: An accordion neatly organizes a large amount of text, preventing cognitive overload and allowing users to focus on one module at a time. -> Library/Method: HTML/CSS/JS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #3a3a3a;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 500px;
            max-height: 60vh;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 400px;
                max-height: 70vh;
            }
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #4A7C59;
            border-bottom-color: #4A7C59;
        }
        .tab-button.active {
            background-color: #4A7C59;
            color: #FFFFFF;
        }
        .accordion-header.active {
            background-color: #EBF0E4;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
    </style>
</head>
<body class="antialiased">

<!-- Botón flotante de accesibilidad (Ubicado correctamente en la esquina inferior derecha) -->
<button id="accessibility-btn" aria-label="Opciones de accesibilidad" title="Accesibilidad" class="fixed bottom-6 right-6 z-50 bg-[#0d9488] hover:bg-[#0d7a6b] text-white font-semibold px-5 py-3 rounded-full shadow-lg transition-colors" style="box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
    <span aria-hidden="true">&#9881;</span>
</button>

<div id="accessibility-panel" role="dialog" aria-modal="true" aria-label="Opciones de accesibilidad" class="hidden fixed bottom-20 right-6 z-50 bg-white border border-slate-200 rounded-xl shadow-lg p-6 w-72">
    <label><input type="checkbox" id="toggle-contrast"> Alto contraste</label><br>
    <label><input type="checkbox" id="toggle-font"> Fuente grande</label><br>
    <label><input type="checkbox" id="toggle-justify" checked disabled> Texto justificado</label><br>
    <label><input type="checkbox" id="toggle-links"> Resaltar enlaces</label><br>
    <label><input type="checkbox" id="toggle-dark"> Modo oscuro</label><br>
    <label><input type="checkbox" id="toggle-lineheight"> Espaciado de líneas</label><br>
    <label><input type="checkbox" id="toggle-cursor"> Cursor grande</label><br>
    <label><input type="checkbox" id="toggle-underline"> Subrayar enlaces</label><br>
    <label><input type="checkbox" id="toggle-dyslexia"> Fuente dislexia</label>
    <hr class="my-2">
    <label for="disability-type" class="font-semibold">Tipo de discapacidad:</label>
    <select id="disability-type" class="w-full mt-1 p-1 rounded border border-slate-300">
        <option value="">Selecciona una opción</option>
        <option value="visual">Visual</option>
        <option value="auditiva">Auditiva</option>
        <option value="motriz">Motriz</option>
        <option value="cognitiva">Cognitiva</option>
        <option value="dislexia">Dislexia</option>
    </select>
</div>

    <header class="bg-[#F0FDFB]/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-[#2C4A38]">
                <span class="text-[#0d9488]">Iris</span> Inclusión
            </div>
            <div class="hidden md:flex space-x-8">
                <a href="#inicio" class="nav-link text-gray-600 font-medium pb-1">Inicio</a>
                <a href="#principios" class="nav-link text-gray-600 font-medium pb-1">Principios</a>
                <a href="#modelos" class="nav-link text-gray-600 font-medium pb-1">Modelos</a>
                <a href="#plan" class="nav-link text-gray-600 font-medium pb-1">Plan Estratégico</a>
                <a href="#sostenibilidad" class="nav-link text-gray-600 font-medium pb-1">Sostenibilidad</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#inicio" class="block py-2 text-gray-600">Inicio</a>
            <a href="#principios" class="block py-2 text-gray-600">Principios</a>
            <a href="#modelos" class="block py-2 text-gray-600">Modelos</a>
            <a href="#plan" class="block py-2 text-gray-600">Plan Estratégico</a>
            <a href="#sostenibilidad" class="block py-2 text-gray-600">Sostenibilidad</a>
        </div>
    </header>

    <main>

        <!-- Se ha eliminado el botón duplicado aquí para evitar la confusión y asegurar que solo el de accesibilidad sea flotante. -->

        <section id="inicio" class="py-20 md:py-32 bg-cover bg-center" style="background-color: #EBF0E4;">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-6xl font-bold text-[#2C4A38] mb-4">Visión y Estrategia</h1>
                <p class="text-lg md:text-xl text-gray-700 max-w-3xl mx-auto">Nuestro compromiso es transformar los entornos sociales en espacios de crecimiento verdaderamente inclusivos y accesibles para todos.</p>
            </div>
        </section>

        <section class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto bg-white p-8 md:p-12 rounded-2xl shadow-lg -mt-32 md:-mt-48 relative z-10">
                    <h2 class="text-3xl font-bold text-[#2C4A38] mb-4 text-center">Resumen Ejecutivo</h2>
                    <p class="text-gray-600 leading-relaxed">
                        Esta iniciativa busca validar y enriquecer una propuesta estratégica para fortalecer nuestra capacidad de alcance comunitario. A través de un análisis comparativo de modelos externos, este plan identifica principios fundamentales como el Diseño Universal, el enfoque funcional y la eco-inclusión. El objetivo es transformar una excelente propuesta en un programa sostenible y replicable, posicionando a Iris Inclusión como un referente de inclusión para nuestros clientes.
                    </p>
                </div>
            </div>
        </section>

        <section id="principios" class="py-16 md:py-24 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-[#2C4A38]">Principios Clave de la Inclusión</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">Estos tres pilares forman la base teórica para crear experiencias que fomentan un entorno verdaderamente acogedor y empoderador.</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300">
                        <h3 class="text-2xl font-bold text-[#4A7C59] mb-4">Diseño Universal</h3>
                        <p class="text-gray-600">Crear entornos utilizables por todas las personas en la mayor medida posible, sin necesidad de adaptaciones. Es un enfoque proactivo que beneficia a todos los participantes.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300">
                        <h3 class="text-2xl font-bold text-[#4A7C59] mb-4">Enfoque Funcional</h3>
                        <p class="text-600">Centrarse en lo que una persona puede hacer, en lugar de en sus limitaciones. Este modelo empodera a los facilitadores para ser creativos, flexibles y adaptar las experiencias a las capacidades de cada individuo.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300">
                        <h3 class="text-2xl font-bold text-[#4A7C59] mb-4">Eco-Inclusión</h3>
                        <p class="text-gray-600">Fusionar la sostenibilidad ambiental con la equidad social. Reconoce que la participación de personas diversas es crucial para la acción comunitaria y ambiental.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="modelos" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-[#2C4A38]">Modelos de Inspiración</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Analizamos programas de diversas entidades para extraer las mejores prácticas. Esta visualización compara las metodologías clave utilizadas en diferentes iniciativas, ayudándonos a aprender de la experiencia de otros.</p>
                </div>
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                    <div class="chart-container">
                        <canvas id="modelsChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="plan" class="py-16 md:py-24 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-[#2C4A38]">Plan Estratégico Fortalecido</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">El plan original es un gran punto de partida, y lo hemos enriquecido con las lecciones aprendidas de otros programas de referencia. Siéntete libre de explorar las recomendaciones específicas para cada módulo haciendo clic en ellos.</p>
                </div>
                <div class="max-w-4xl mx-auto">
                    <div class="space-y-4" id="accordion-container">
                    </div>
                </div>
            </div>
        </section>

        <!-- New section for timeline -->
        <section id="timeline-section" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-[#2C4A38]">Línea de Tiempo del Plan de Acción</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Un cronograma claro para la implementación del programa, desde la capacitación hasta la socialización con la comunidad.</p>
                </div>
                <div class="max-w-4xl mx-auto relative">
                    <div class="absolute left-1/2 -ml-0.5 w-1 bg-gray-200 h-full hidden md:block"></div>
                    <div class="space-y-8 md:space-y-16">
                        <!-- Step 1 -->
                        <div class="relative flex md:justify-start justify-center md:items-center">
                            <div class="md:w-1/2 md:pr-12 md:text-right text-center">
                                <h3 class="text-xl font-bold text-[#4A7C59] mb-2">Taller: Módulo 1</h3>
                                <p class="text-gray-600">Pautas para la Inclusión en la Interacción con Usuarios. El personal recibe los fundamentos teóricos para entender los distintos tipos de discapacidad.</p>
                            </div>
                            <div class="hidden md:flex absolute inset-y-0 left-1/2 items-center justify-center">
                                <div class="bg-[#4A7C59] h-8 w-8 rounded-full shadow-lg"></div>
                            </div>
                        </div>
                        <!-- Step 2 -->
                        <div class="relative flex md:justify-end justify-center md:items-center">
                            <div class="md:w-1/2 md:pl-12 md:text-left text-center">
                                <h3 class="text-xl font-bold text-[#4A7C59] mb-2">Taller: Módulo 2</h3>
                                <p class="text-gray-600">Estrategias para Manejo de Grupos en Entornos Abiertos o Cerrados. Aplicación práctica de las técnicas de manejo de grupos y comunicación inclusiva.</p>
                            </div>
                            <div class="hidden md:flex absolute inset-y-0 right-1/2 items-center justify-center">
                                <div class="bg-[#4A7C59] h-8 w-8 rounded-full shadow-lg"></div>
                            </div>
                        </div>
                        <!-- Step 3 -->
                        <div class="relative flex md:justify-start justify-center md:items-center">
                            <div class="md:w-1/2 md:pr-12 md:text-right text-center">
                                <h3 class="text-xl font-bold text-[#4A7C59] mb-2">Taller: Módulo 3</h3>
                                <p class="text-gray-600">Actividad Lúdica y Aprendizaje Práctico. El personal diseña y presenta una actividad, consolidando el aprendizaje de manera interactiva.</p>
                            </div>
                            <div class="hidden md:flex absolute inset-y-0 left-1/2 items-center justify-center">
                                <div class="bg-[#4A7C59] h-8 w-8 rounded-full shadow-lg"></div>
                            </div>
                        </div>
                        <!-- Final Step -->
                        <div class="relative flex md:justify-end justify-center md:items-center">
                            <div class="md:w-1/2 md:pl-12 md:text-left text-center">
                                <h3 class="text-xl font-bold text-[#2C4A38] mb-2">Presentación y Socialización Institucional</h3>
                                <p class="text-gray-600">Invitación formal a instituciones especializadas para presentar y socializar los nuevos alcances del programa, así como para el desarrollo del <strong>Comité de Colaboración</strong> desde Iris Inclusión. Se fortalece lazos y se crea un canal de retroalimentación formal.</p>
                            </div>
                            <div class="hidden md:flex absolute inset-y-0 right-1/2 items-center justify-center">
                                <div class="bg-[#2C4A38] h-10 w-10 rounded-full shadow-lg flex items-center justify-center text-white text-xl font-bold">✓</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="sostenibilidad" class="py-16 md:py-24 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-[#2C4A38]">Estrategia de Sostenibilidad a Largo Plazo</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Para que nuestra visión se convierta en un pilar permanente, proponemos una estrategia que asegura un impacto duradero.</p>
                </div>
                <div class="max-w-5xl mx-auto grid md:grid-cols-3 gap-8 text-center">
                    <div class="bg-white p-8 rounded-xl shadow-md">
                        <div class="text-4xl text-[#4A7C59] mb-4">①</div>
                        <h3 class="text-xl font-bold mb-2">Comité de Colaboración</h3>
                        <p class="text-gray-600">Establecer un comité permanente con personal y representantes de la comunidad para una retroalimentación y mejora continua.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md">
                        <div class="text-4xl text-[#4A7C59] mb-4">②</div>
                        <h3 class="text-xl font-bold mb-2">Alianzas Estratégicas</h3>
                        <p class="text-gray-600">Formalizar la colaboración con organizaciones clave para co-crear experiencias relevantes y asegurar que los programas lleguen a quienes más los necesitan.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md">
                        <div class="text-4xl text-[#4A7C59] mb-4">③</div>
                        <h3 class="text-xl font-bold mb-2">Reconocimiento Institucional</h3>
                        <p class="text-gray-600">Crear una certificación para el personal capacitado, validando su experiencia y sirviendo como incentivo para la excelencia continua.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="contacto" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-[#2C4A38]">Contáctanos</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Si quiere mas información/precios sobre los talleres psicoeducativos sobre inclusión en espacios sociales y/o educativos, no dudes en escribirnos.</p>
                </div>
                <div class="max-w-lg mx-auto bg-white p-8 rounded-xl shadow-lg">
                    <form id="contact-form" class="space-y-6">
                        <div>
                            <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
                            <input type="text" id="nombre" name="nombre" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4A7C59] focus:ring focus:ring-[#4A7C59] focus:ring-opacity-50">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Correo Electrónico</label>
                            <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4A7C59] focus:ring focus:ring-[#4A7C59] focus:ring-opacity-50">
                        </div>
                        <div>
                            <label for="mensaje" class="block text-sm font-medium text-gray-700">Mensaje</label>
                            <textarea id="mensaje" name="mensaje" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4A7C59] focus:ring focus:ring-[#4A7C59] focus:ring-opacity-50"></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="w-full inline-flex justify-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-[#4A7C59] hover:bg-[#3A6B4A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#4A7C59]">Enviar Mensaje</button>
                        </div>
                    </form>
                </div>
                </div>
        </section>
    </main>

    <footer class="bg-[#0d9488] text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Iris Inclusión. Creando un futuro más inclusivo y sostenible.</p>
        </div>
    </footer>

    <script src="/assets/js/modelsChart.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Inyectar estilos necesarios para las opciones de accesibilidad ---
            (function injectAccessibilityStyles(){
                if (document.getElementById('iris-accessibility-styles')) return;
                const css = `
                /* Accessibility helpers injected by build */
                .iris-contrast { background-color: #ffffff !important; color: #000000 !important; }
                .iris-font-large { font-size: 18px !important; }
                .iris-lineheight { line-height: 1.9 !important; }
                .iris-dyslexia { font-family: 'OpenDyslexic', 'Inter', Arial, sans-serif !important; }
                .iris-underline-links a, .iris-underline-links a:visited { text-decoration: underline !important; }
                .iris-highlight-links a { background-color: #fff3bf; padding: 0 2px; border-radius: 2px; }
                .iris-dark { background-color: #0b1220 !important; color: #e6eef8 !important; }
                .iris-cursor-large * { cursor: pointer !important; }
                #accessibility-panel[aria-hidden="true"] { display: none; }

                /* Dark mode: force high-contrast text and dark backgrounds for common elements */
                .iris-dark, .iris-dark body, .iris-dark .container, .iris-dark main, .iris-dark footer {
                  background-color: #0b1220 !important;
                  color: #e6eef8 !important;
                }

                /* Override frequently used light background utility classes so panels/cards switch to dark */
                .iris-dark .bg-white, .iris-dark .bg-gray-50, .iris-dark .rounded-2xl, .iris-dark .rounded-xl, .iris-dark .p-6, .iris-dark .p-8, .iris-dark .p-12 {
                  background-color: #0f1724 !important;
                  color: #e6eef8 !important;
                  box-shadow: none !important;
                  border-color: rgba(255,255,255,0.06) !important;
                }

                /* Accessibility panel specific */
                .iris-dark #accessibility-panel {
                  background-color: #0f1724 !important;
                  color: #e6eef8 !important;
                  border-color: rgba(255,255,255,0.06) !important;
                }
                .iris-dark #accessibility-panel label,
                .iris-dark #accessibility-panel option,
                .iris-dark #accessibility-panel select,
                .iris-dark #accessibility-panel input,
                .iris-dark #accessibility-panel textarea {
                  color: #e6eef8 !important;
                  background-color: transparent !important;
                  border-color: rgba(255,255,255,0.12) !important;
                }

                /* Floating accessibility button in dark mode */
                .iris-dark #accessibility-btn {
                  background-color: #1f2937 !important;
                  color: #e6eef8 !important;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.45) !important;
                }

                /* Ensure headings, links and small text remain readable */
                .iris-dark h1, .iris-dark h2, .iris-dark h3, .iris-dark h4, .iris-dark p, .iris-dark a, .iris-dark li, .iris-dark span {
                  color: #e6eef8 !important;
                }

                /* Keep highlighted links visible in dark */
                .iris-dark .iris-highlight-links a {
                  background-color: rgba(255,243,191,0.08) !important;
                  color: #fff3bf !important;
                }

                /* Chart canvas background neutrality */
                .iris-dark .chart-container, .iris-dark .chart-container canvas {
                  background-color: transparent !important;
                }

                /* Inputs focus visible in dark */
                .iris-dark input:focus, .iris-dark select:focus, .iris-dark textarea:focus {
                  outline: 2px solid rgba(255,255,255,0.12) !important;
                }
                `;
                const style = document.createElement('style');
                style.id = 'iris-accessibility-styles';
                style.appendChild(document.createTextNode(css));
                document.head.appendChild(style);
            })();

            // --- Elementos ---
            const accBtn = document.getElementById('accessibility-btn');
            const accPanel = document.getElementById('accessibility-panel');
            const toggleContrast = document.getElementById('toggle-contrast');
            const toggleFont = document.getElementById('toggle-font');
            const toggleJustify = document.getElementById('toggle-justify'); // readonly
            const toggleLinks = document.getElementById('toggle-links');
            const toggleDark = document.getElementById('toggle-dark');
            const toggleLineheight = document.getElementById('toggle-lineheight');
            const toggleCursor = document.getElementById('toggle-cursor');
            const toggleUnderline = document.getElementById('toggle-underline');
            const toggleDyslexia = document.getElementById('toggle-dyslexia');
            const disabilityType = document.getElementById('disability-type');

            const STORAGE_KEY = 'iris_accessibility_v1';

            // --- Focus trap helpers ---
            let lastFocused = null;
            function trapFocus() {
                lastFocused = document.activeElement;
                const focusable = accPanel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (focusable.length) focusable[0].focus();
                function handleTab(e) {
                    if (e.key !== 'Tab') return;
                    const focusables = accPanel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                    if (!focusables.length) return;
                    const first = focusables[0];
                    const last = focusables[focusables.length - 1];
                    if (e.shiftKey && document.activeElement === first) {
                        e.preventDefault();
                        last.focus();
                    } else if (!e.shiftKey && document.activeElement === last) {
                        e.preventDefault();
                        first.focus();
                    }
                }
                accPanel.__tabHandler = handleTab;
                document.addEventListener('keydown', handleTab);
            }
            function releaseFocus() {
                if (accPanel.__tabHandler) {
                    document.removeEventListener('keydown', accPanel.__tabHandler);
                    accPanel.__tabHandler = null;
                }
                if (lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
            }

            // --- Open / Close panel ---
            function openPanel() {
                accPanel.classList.remove('hidden');
                accPanel.setAttribute('aria-hidden', 'false');
                accBtn.setAttribute('aria-expanded', 'true');
                trapFocus();
            }
            function closePanel() {
                accPanel.classList.add('hidden');
                accPanel.setAttribute('aria-hidden', 'true');
                accBtn.setAttribute('aria-expanded', 'false');
                releaseFocus();
            }

            // Toggle via button
            if (accBtn) {
                accBtn.addEventListener('click', function(e){
                    e.preventDefault();
                    if (accPanel.classList.contains('hidden') || accPanel.getAttribute('aria-hidden') === 'true') {
                        openPanel();
                    } else {
                        closePanel();
                    }
                });

                // Keyboard support on button
                accBtn.addEventListener('keydown', function(e){
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        accBtn.click();
                    }
                });
            }

            // Close when clicking outside
            document.addEventListener('click', function(e){
                if (accPanel && !accPanel.contains(e.target) && accBtn && !accBtn.contains(e.target) && accPanel.getAttribute('aria-hidden') === 'false') {
                    closePanel();
                }
            });

            // Close with Escape
            document.addEventListener('keydown', function(e){
                if (e.key === 'Escape' && accPanel && accPanel.getAttribute('aria-hidden') === 'false') {
                    closePanel();
                }
            });

            // --- Apply / Persist settings ---
            function readSaved() {
                try {
                    const raw = localStorage.getItem(STORAGE_KEY);
                    return raw ? JSON.parse(raw) : {};
                } catch (e) { return {}; }
            }
            function saveSettings(s) {
                try { localStorage.setItem(STORAGE_KEY, JSON.stringify(s || {})); } catch(e){}
            }

            function applySettings(s){
                const root = document.documentElement;
                s = s || {};
                // contrast
                if (s.contrast) root.classList.add('iris-contrast'); else root.classList.remove('iris-contrast');
                // font
                if (s.font) root.classList.add('iris-font-large'); else root.classList.remove('iris-font-large');
                // dark
                if (s.dark) root.classList.add('iris-dark'); else root.classList.remove('iris-dark');
                // lineheight
                if (s.lineheight) root.classList.add('iris-lineheight'); else root.classList.remove('iris-lineheight');
                // cursor
                if (s.cursor) root.classList.add('iris-cursor-large'); else root.classList.remove('iris-cursor-large');
                // dyslexia
                if (s.dyslexia) root.classList.add('iris-dyslexia'); else root.classList.remove('iris-dyslexia');
                // links highlight
                if (s.links) root.classList.add('iris-highlight-links'); else root.classList.remove('iris-highlight-links');
                // underline links
                if (s.underline) root.classList.add('iris-underline-links'); else root.classList.remove('iris-underline-links');

                // update controls state
                if (toggleContrast) toggleContrast.checked = !!s.contrast;
                if (toggleFont) toggleFont.checked = !!s.font;
                if (toggleDark) toggleDark.checked = !!s.dark;
                if (toggleLineheight) toggleLineheight.checked = !!s.lineheight;
                if (toggleCursor) toggleCursor.checked = !!s.cursor;
                if (toggleDyslexia) toggleDyslexia.checked = !!s.dyslexia;
                if (toggleLinks) toggleLinks.checked = !!s.links;
                if (toggleUnderline) toggleUnderline.checked = !!s.underline;
            }

            // Load saved on start
            const saved = readSaved();
            applySettings(saved);

            // Handlers for controls
            function onChangeHandler() {
                const state = {
                    contrast: !!(toggleContrast && toggleContrast.checked),
                    font: !!(toggleFont && toggleFont.checked),
                    dark: !!(toggleDark && toggleDark.checked),
                    lineheight: !!(toggleLineheight && toggleLineheight.checked),
                    cursor: !!(toggleCursor && toggleCursor.checked),
                    dyslexia: !!(toggleDyslexia && toggleDyslexia.checked),
                    links: !!(toggleLinks && toggleLinks.checked),
                    underline: !!(toggleUnderline && toggleUnderline.checked)
                };
                applySettings(state);
                saveSettings(state);
            }

            [toggleContrast, toggleFont, toggleDark, toggleLineheight, toggleCursor, toggleDyslexia, toggleLinks, toggleUnderline].forEach(el => {
                if (!el) return;
                el.addEventListener('change', onChangeHandler);
            });

            // Disability presets
            if (disabilityType) {
                disabilityType.addEventListener('change', function(){
                    const v = disabilityType.value;
                    const preset = {};
                    if (v === 'visual') { preset.contrast = true; preset.font = true; preset.lineheight = true; }
                    else if (v === 'auditiva') { /* no visual changes, maybe subtitles elsewhere */ }
                    else if (v === 'motriz') { preset.cursor = true; }
                    else if (v === 'cognitiva') { preset.lineheight = true; preset.underline = true; preset.dyslexia = true; }
                    else if (v === 'dislexia') { preset.dyslexia = true; preset.underline = true; }
                    const merged = Object.assign({}, readSaved(), preset);
                    applySettings(merged);
                    saveSettings(merged);
                });
            }

            // Contact form: show confirmation on submit
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const submitBtn = contactForm.querySelector('button[type="submit"]');
                    // accessible status region
                    let status = contactForm.querySelector('.contact-status');
                    if (!status) {
                        status = document.createElement('div');
                        status.className = 'contact-status mt-3 text-green-700 font-semibold';
                        status.setAttribute('role', 'status');
                        status.setAttribute('aria-live', 'polite');
                        contactForm.appendChild(status);
                    }
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        const originalText = submitBtn.textContent;
                        submitBtn.textContent = 'Mensaje recibido';
                        status.textContent = 'Gracias — tu mensaje fue recibido.';
                        // restore after 4 segundos
                        setTimeout(() => {
                            submitBtn.disabled = false;
                            submitBtn.textContent = originalText;
                            // opcional: limpiar el status
                            if (status) status.textContent = '';
                        }, 4000);
                    }
                });
            }

        });
    </script>
</body>
</html>
