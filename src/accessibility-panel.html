<!-- accessibility-panel: botón flotante, panel y script -->
<button id="accessibility-btn" class="fixed bottom-6 left-6 z-50 bg-[#0d9488] text-white px-4 py-3 rounded-lg shadow-md hover:bg-[#0d7a6b]" aria-haspopup="dialog" aria-controls="accessibility-panel">Accesibilidad</button>

<style>
  /* reglas de demostración para accesibilidad */
  html.acc-visual { font-size: 1.15rem; }
  html.acc-visual body { filter: contrast(1.05) saturate(1.05); }
  html.acc-dislexia { font-family: 'OpenDyslexic', Inter, sans-serif; }
  html.acc-motriz a, html.acc-motriz button { padding: 0.75rem; }
  /* high contrast for demonstration */
  html.acc-cognitiva { line-height: 1.6; }
  /* ensure accessibility button is always on top and fixed and clickable */
  #accessibility-btn { position: fixed; z-index: 99999 !important; pointer-events: auto !important; }
  /* ensure panel is interactive */
  #accessibility-panel { pointer-events: auto; }
</style>

<div id="accessibility-panel" class="fixed bottom-20 left-6 z-50 w-80 bg-white border border-gray-200 rounded-lg p-4 shadow-lg hidden" role="dialog" aria-label="Panel de accesibilidad">
  <h3 class="text-lg font-semibold mb-2">Ajustes de accesibilidad</h3>
  <p class="text-sm text-gray-600 mb-3">Selecciona una preferencia para ajustar la interfaz.</p>
  <div role="radiogroup" aria-label="Tipo de discapacidad">
    <label class="flex items-center mb-2 cursor-pointer">
      <input type="radio" name="disabilityType" id="dis_visual" value="visual" class="mr-2">
      <span>Tecnologías visuales</span>
    </label>
    <label class="flex items-center mb-2 cursor-pointer">
      <input type="radio" name="disabilityType" id="dis_auditiva" value="auditiva" class="mr-2">
      <span>Tecnologías auditivas</span>
    </label>
    <label class="flex items-center mb-2 cursor-pointer">
      <input type="radio" name="disabilityType" id="dis_motriz" value="motriz" class="mr-2">
      <span>Soporte motriz</span>
    </label>
    <label class="flex items-center mb-2 cursor-pointer">
      <input type="radio" name="disabilityType" id="dis_cognitiva" value="cognitiva" class="mr-2">
      <span>Facilidades cognitivas</span>
    </label>
    <label class="flex items-center mb-2 cursor-pointer">
      <input type="radio" name="disabilityType" id="dis_dislexia" value="dislexia" class="mr-2">
      <span>Soporte de lectura</span>
    </label>
  </div>
  <p id="accessibility-note" class="mt-3 text-xs text-gray-500">Los cambios son temporales y locales en tu navegador.</p>
</div>

<script>
// Global toggle function (robust fallback) — kept minimal and safe
window.toggleAccessibilityPanel = function(){
  try {
    const accBtn = document.getElementById('accessibility-btn');
    const accPanel = document.getElementById('accessibility-panel');
    if (!accBtn || !accPanel) return;
    const hidden = accPanel.classList.toggle('hidden');
    accPanel.style.display = hidden ? 'none' : '';
    accBtn.setAttribute('aria-expanded', String(!hidden));
    if (!hidden){
      const first = accPanel.querySelector('input, button, [tabindex]');
      if (first) first.focus();
    }
  } catch (e) {
    // silent
  }
};

(function () {
  function setupAccessibility() {
    const accBtn = document.getElementById('accessibility-btn');
    const accPanel = document.getElementById('accessibility-panel');
    if (accBtn && accPanel) {
      // normalize display in case Tailwind 'hidden' is removed by compilation
      if (accPanel.classList.contains('hidden')) accPanel.style.display = 'none';
      else accPanel.style.display = '';
      accBtn.setAttribute('aria-expanded', String(accPanel.style.display !== 'none'));
      accBtn.addEventListener('click', function () {
        const isHidden = accPanel.classList.toggle('hidden');
        if (isHidden) {
          accPanel.style.display = 'none';
        } else {
          accPanel.style.display = '';
          // move focus inside panel for accessibility
          const firstInput = accPanel.querySelector('input, button, [tabindex]');
          if (firstInput) firstInput.focus();
        }
        accBtn.setAttribute('aria-expanded', String(!isHidden));
      });
    }

    // El build busca "disabilityType.onchange" en el script; mantén la referencia
    const disabilityType = document.querySelector('input[name="disabilityType"]');
    if (disabilityType) {
      function applyAccessibility() {
  const val = document.querySelector('input[name="disabilityType"]:checked')?.value || '';
        document.documentElement.setAttribute('data-accessibility', val);
        // keep the button visible and on top
        const accBtnEl = document.getElementById('accessibility-btn');
        if (accBtnEl) {
          accBtnEl.style.position = 'fixed';
          accBtnEl.style.zIndex = '99999';
          accBtnEl.style.display = '';
        }
        // Apply simple visual adjustments based on selection
        document.documentElement.classList.remove('acc-visual','acc-auditiva','acc-motriz','acc-cognitiva','acc-dislexia');
        if (val === 'visual') document.documentElement.classList.add('acc-visual');
        if (val === 'auditiva') document.documentElement.classList.add('acc-auditiva');
        if (val === 'motriz') document.documentElement.classList.add('acc-motriz');
        if (val === 'cognitiva') document.documentElement.classList.add('acc-cognitiva');
        if (val === 'dislexia') document.documentElement.classList.add('acc-dislexia');

        // Map human-readable descriptions for the panel
        const descriptions = {
          'visual': 'Aumenta tamaño de fuente y contraste ligero',
          'auditiva': 'Activa ayudas auditivas/lectura (no aplica visualmente)',
          'motriz': 'Elementos interactivos con mayor área clicable',
          'cognitiva': 'Mayor interlineado y ritmo de lectura mejorado',
          'dislexia': 'Tipografía y espaciado optimizados para lectura'
        };
        const noteEl = document.getElementById('accessibility-note');
        if (noteEl) noteEl.textContent = 'Modo: ' + (val || 'predeterminado') + (val ? ' — ' + (descriptions[val] || '') : ' — Sin cambios aplicados');
      }
      // attach both change and click to be robust across browsers
      document.querySelectorAll('input[name="disabilityType"]').forEach(r => {
        r.addEventListener('change', function() { applyAccessibility(); });
        r.addEventListener('click', function() { applyAccessibility(); });
      });
      // also call once to set initial state if any radio is pre-checked
      applyAccessibility();
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupAccessibility);
  } else {
    setupAccessibility();
  }
})();
</script>
